<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width,initial-scale=1" />
        <title>idae-router demo</title>
    </head>
    <body>
        <div id="app"></div>

        <nav>
            <a href="/">Home</a> | <a href="/about">About</a> | <a href="/posts">Posts</a> |
            <a href="/user/42">User 42</a>
        </nav>

        <button id="go-user">Go user 99</button>
        <button id="refresh">Refresh</button>

        <script type="module">
            import { createRouter } from '/dist/index.js';

            const routes = [
                { path: '/', action: () => '<h1>Home</h1><p>Demo home</p>' },
                {
                    path: '/about',
                    action: () => {
                        const frag = document.createDocumentFragment();
                        const h = document.createElement('h1');
                        h.textContent = 'About';
                        frag.appendChild(h);
                        return frag;
                    }
                },
                {
                    path: '/user/:id',
                    action: async (ctx) => {
                        await new Promise((r) => setTimeout(r, 50));
                        const el = document.createElement('div');
                        el.innerHTML = `<h1>User ${ctx.params.id}</h1><p>Loaded async</p>`;
                        const timer = setInterval(() => console.log('poll', ctx.params.id), 1000);
                        return () => clearInterval(timer);
                    }
                },
                {
                    path: '/posts',
                    action: () => {
                        const el = document.createElement('div');
                        el.innerHTML =
                            '<h1>Posts</h1><ul><li><a href="/posts/1/comments">Post 1 comments</a></li></ul>';
                        return el;
                    }
                },
                {
                    path: '/posts/:postId/comments',
                    action: (ctx) => {
                        console.log('comments', ctx.params.postId);
                        return;
                    }
                }
            ];

            const router = createRouter({
                routes,
                outlet: '#app',
                mode: 'history',
                linkInterception: true,
                notFound: () => '<h1>404</h1>'
            });

            router.before((to, from, next) => {
                next();
            });
            router.after((to) => console.log('after', to.path));
            router.onLeave((from) => console.log('leave', from.path));

            document.getElementById('go-user').addEventListener('click', () => router.push('/user/99'));
            document.getElementById('refresh').addEventListener('click', () => router.refresh());
        </script>
    </body>
</html>
