<style>
  body{font-family:system-ui,Arial,sans-serif;padding:16px}
  .log{font-family:monospace;background:#111;color:#bada55;padding:8px;margin-top:8px;height:120px;overflow:auto}
  .card{border:1px solid #ddd;padding:8px;margin:8px 0}
</style>

<h1>exampleInline â€” demo</h1>
<p>Demonstrates the exampleInline component behavior (console-driven). The demo inserts multiple blocks that trigger the component's runtime.</p>


<div data-component="exampleInline">
  <div>
    <button data-insert>Insert example block</button>
    <button data-insert-5>Insert 5 blocks</button>
  </div>
  <div data-container></div>
</div>

<div class="card">
  <h3>Console log (captured)</h3>
  <div id="out" class="log"></div>
</div>

<script type="module">
  import { be, toBe, createBe, core } from '/packages/idae-html/src/lib/core-engine.ts';
  // capture console.log to UI for demo
  (function(){
    const outBe = be('#out');
    const orig = console.log;
    console.log = function(...args){
      orig.apply(console,args);
      const html = args.map(a => typeof a === 'object' ? JSON.stringify(a) : String(a)).join(' ');
      outBe.append(toBe(`<div>${html}</div>`));
      const outEl = outBe.node as HTMLElement;
      outEl.scrollTop = outEl.scrollHeight;
    }
  })();

  core.registerComponent('exampleInline', {
    script: (root, props)=> {
      const rootEl = (root instanceof Element) ? root : (root as any).node || document;
      const insertBtn = rootEl.querySelector('[data-insert]') as HTMLElement | null;
      const insert5Btn = rootEl.querySelector('[data-insert-5]') as HTMLElement | null;
      const container = rootEl.querySelector('[data-container]') as HTMLElement | null;
      if (!insertBtn || !insert5Btn || !container) return;

      async function insertOne(){
        const res = await fetch('/packages/idae-html/dist/exampleInline.html');
        const text = await res.text();
        const wrapperBe = createBe('div'); wrapperBe.update(text);
        const styleBe = wrapperBe.find('style'); const scriptBe = wrapperBe.find('script');
        const styleEl = Array.isArray(styleBe.node) ? (styleBe.node[0] as HTMLElement) : (styleBe.node as HTMLElement);
        const scriptEl = Array.isArray(scriptBe.node) ? (scriptBe.node[0] as HTMLElement) : (scriptBe.node as HTMLElement);
        if (styleEl){
          const existing = be('head').find('style[data-component="exampleInline"]');
          const found = existing.node;
          const hasExisting = Array.isArray(found) ? (found as HTMLElement[]).length > 0 : !!found;
          if (!hasExisting){ const sBe = createBe('style', { attributes: { 'data-component': 'exampleInline' } }); sBe.update(styleEl.textContent || ''); be('head').append(sBe); }
        }
        if (scriptEl){ const scBe = createBe('script'); scBe.update(scriptEl.textContent || ''); be('head').append(scBe); }
        const elBe = createBe('div', { className: 'card' });
        const innerBe = createBe('div', { attributes: { 'data-component': 'exampleInline' } });
        elBe.append(innerBe);
        be(container).append(elBe);
        const init = (window as any)['exampleInline'] || (window as any)['exampleInline'.replace(/[^a-zA-Z0-9]/g,'_')];
        const innerEl = Array.isArray(innerBe.node) ? innerBe.node[0] : (innerBe.node as HTMLElement);
        if (typeof init === 'function') init(innerEl);
      }

      be(insertBtn).on('click', insertOne);
      be(insert5Btn).on('click', ()=>{ for(let i=0;i<5;i++) insertOne(); });
      insertOne();
    },
    props: {},
    resources: [],
    on: {},
    meta: {
      author: 'idae-html',
      version: '1.0.0',
      description: 'An example component that dynamically loads and inserts other components.'
    }
  });
</script>
