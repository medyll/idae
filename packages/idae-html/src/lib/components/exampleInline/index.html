<style>
  body{font-family:system-ui,Arial,sans-serif;padding:16px}
  .log{font-family:monospace;background:#111;color:#bada55;padding:8px;margin-top:8px;height:120px;overflow:auto}
  .card{border:1px solid #ddd;padding:8px;margin:8px 0}
</style>

<h1>exampleInline â€” demo</h1>
<p>Demonstrates the exampleInline component behavior (console-driven). The demo inserts multiple blocks that trigger the component's runtime.</p>

<div>
  <button id="insert">Insert example block</button>
  <button id="insert-5">Insert 5 blocks</button>
</div>

<div id="container"></div>

<div class="card">
  <h3>Console log (captured)</h3>
  <div id="out" class="log"></div>
</div>

<script type="module">
  import { be, toBe, createBe, app } from '/packages/idae-html/src/lib/core-engine.ts';
  // capture console.log to UI for demo
  (function(){
    const outBe = be('#out');
    const orig = console.log;
    console.log = function(...args){
      orig.apply(console,args);
      const html = args.map(a => typeof a === 'object' ? JSON.stringify(a) : String(a)).join(' ');
      outBe.append(toBe(`<div>${html}</div>`));
      const outEl = outBe.node as HTMLElement;
      outEl.scrollTop = outEl.scrollHeight;
    }
  })();

  async function insertOne(){
    const res = await fetch('/packages/idae-html/dist/exampleInline.html');
    const text = await res.text();
    const wrapperBe = createBe('div'); wrapperBe.update(text);
    const styleBe = wrapperBe.find('style'); const scriptBe = wrapperBe.find('script');
    const styleEl = Array.isArray(styleBe.node) ? (styleBe.node[0] as HTMLElement) : (styleBe.node as HTMLElement);
    const scriptEl = Array.isArray(scriptBe.node) ? (scriptBe.node[0] as HTMLElement) : (scriptBe.node as HTMLElement);
    if (styleEl){
      const existing = be('head').find('style[data-component="exampleInline"]');
      const found = existing.node;
      const hasExisting = Array.isArray(found) ? (found as HTMLElement[]).length > 0 : !!found;
      if (!hasExisting){ const sBe = createBe('style', { attributes: { 'data-component': 'exampleInline' } }); sBe.update(styleEl.textContent || ''); be('head').append(sBe); }
    }
    if (scriptEl){ const scBe = createBe('script'); scBe.update(scriptEl.textContent || ''); be('head').append(scBe); }
    const elBe = createBe('div', { className: 'card' });
    const innerBe = createBe('div', { attributes: { 'data-component': 'exampleInline' } });
    elBe.append(innerBe);
    be('#container').append(elBe);
    const init = window['exampleInline'] || window['exampleInline'.replace(/[^a-zA-Z0-9]/g,'_')];
    const innerEl = Array.isArray(innerBe.node) ? innerBe.node[0] : (innerBe.node as HTMLElement);
    if (typeof init === 'function') init(innerEl);
  }

  be('#insert').on('click', insertOne);
  be('#insert-5').on('click', ()=>{ for(let i=0;i<5;i++) insertOne(); });

  // auto insert one
  insertOne();
</script>
