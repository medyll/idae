<style>
  body{font-family:system-ui,Arial,sans-serif;padding:16px}
  .bar{width:100%;background:#eee;height:18px;border-radius:9px;overflow:hidden}
  .fill{height:100%;background:linear-gradient(90deg,#4caf50,#8bc34a);width:0%}
  .spinner{width:32px;height:32px;border-radius:50%;border:4px solid #eee;border-top-color:#3498db;animation:spin 1s linear infinite}
  @keyframes spin{to{transform:rotate(360deg)}}
</style>

<h1>Progress / Spinner</h1>
<div data-component="progress">
  <div class="card">
    <h3>Determinate</h3>
    <div class="bar"><div data-fill class="fill"></div></div>
    <button data-start>Start</button>
  </div>

  <div class="card">
    <h3>Indeterminate spinner</h3>
    <div data-spin class="spinner" aria-hidden="false"></div>
    <button data-toggle>Toggle spinner</button>
  </div>
</div>

<script type="module">
  import { be, core } from '/packages/idae-html/src/lib/core-engine.ts';

  core.registerComponent('progress', {
    script(root){
    const rootEl = (root instanceof Element) ? root : (root as any).node || document;
    const fillEl = rootEl.querySelector('[data-fill]') as HTMLElement | null;
    const startEl = rootEl.querySelector('[data-start]') as HTMLElement | null;
    const spinEl = rootEl.querySelector('[data-spin]') as HTMLElement | null;
    const toggleEl = rootEl.querySelector('[data-toggle]') as HTMLElement | null;
    if (!fillEl || !startEl || !spinEl || !toggleEl) return;

    const fillBe = be(fillEl);
    let p = 0; let interval: any = null;
    be(startEl).on('click', ()=>{
      p = 0; fillBe.setStyle({ width: '0%' }); clearInterval(interval);
      interval = setInterval(()=>{ p += 5; fillBe.setStyle({ width: p + '%' }); if (p>=100) clearInterval(interval); }, 200);
    });

    const spinBe = be(spinEl);
    be(toggleEl).on('click', ()=>{
      const show = (spinEl.style.display === 'none') ? 'inline-block' : 'none';
      spinBe.setStyle({ display: show });
    });
  }});
</script>
