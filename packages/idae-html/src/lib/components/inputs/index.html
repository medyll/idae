<style>
  .inputs-root{padding:var(--gutter-md);font-size:var(--font-md);color:var(--color-foreground)}
  .field{margin-bottom:var(--gutter-sm)}
  .error{color:var(--color-destructive);font-size:90%}
  input.invalid{border-color:var(--color-destructive)}
  input{border-style:solid;border-width:var(--border-sm);border-color:var(--color-border);padding:6px}
</style>

<h1 class="font-lg text-foreground">Inputs</h1>
<div data-component="inputs" class="inputs-root">
  <form>
    <div class="field"><label>Text (required): <input name="name" required></label><div class="error" data-for="name"></div></div>
    <div class="field"><label>Number (1-100): <input name="age" type="number" min="1" max="100"></label><div class="error" data-for="age"></div></div>
    <div class="field"><label>Textarea: <textarea name="bio"></textarea></label></div>
    <div class="field"><label>Phone (mask): <input name="phone" placeholder="+1 (___) ___-____"></label><div class="error" data-for="phone"></div></div>
    <div><button type="submit">Submit</button></div>
  </form>
</div>

<script type="module" lang="ts">
  import { be, core } from '$lib/core-engine.ts';

  core.registerComponent('inputs', {
    script: (root, props)=> {
    const rootEl = (root instanceof Element) ? root : (root as any).node || document;
    const formEl = rootEl.querySelector('form') as HTMLFormElement | null;
    if (!formEl) return;

    function setError(name: string, msg?: string){
      const errBe = be(rootEl.querySelector(`[data-for="${name}"]`));
      if (errBe) errBe.updateText(msg || '');
      const input = (formEl.elements as any)[name];
      if (input) be(input).toggleClass('invalid', !!msg);
    }

    function phoneMask(v: string){
      const digits = v.replace(/\D/g,'').slice(0,11);
      let s = digits;
      if (s.length>1) s = '+'+s;
      return s;
    }

    const phone = (formEl.elements as any)['phone'];
    function onPhoneInput(){ if (phone) phone.value = phoneMask(phone.value); }

    function onSubmit(e: Event){
      e.preventDefault();
      let ok = true;
      if (!((formEl.elements as any)['name'].value || '').trim()){ setError('name','Name is required'); ok=false; } else setError('name','');
      const age = parseInt(((formEl.elements as any)['age'].value || ''),10);
      if (isNaN(age) || age<1 || age>100){ setError('age','Age must be between 1 and 100'); ok=false; } else setError('age','');
      if (!/\+?\d{2,}/.test(((formEl.elements as any)['phone'].value || ''))){ setError('phone','Enter a valid phone'); ok=false; } else setError('phone','');
      if (ok) alert('Form OK â€” '+JSON.stringify({name:(formEl.elements as any)['name'].value, age: (formEl.elements as any)['age'].value, phone: (formEl.elements as any)['phone'].value}));
    }

    if (phone) be(phone).on('input', onPhoneInput);
    be(formEl).on('submit', onSubmit);

    return () => {
      try{ if (phone) be(phone).off('input', onPhoneInput); }catch(e){}
      try{ be(formEl).off('submit', onSubmit); }catch(e){}
    };
  },
    props: {},
    resources: [],
    on: {},
    meta: {
      author: 'idae-html',
      version: '1.0.0',
      description: 'A form inputs component with validation and masking.'
    }
  });
</script>
