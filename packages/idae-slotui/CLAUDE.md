# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Package identity

`@medyll/idae-slotui-svelte` — a Svelte 5 component library that is part of the `idae` monorepo. It targets both a distributable npm package (`dist/`) and a shadcn-style registry of copyable components (`registry/`).

## Commands

```bash
# Development server
npm run dev

# Build library (vite build + svelte-package)
npm run build

# Type-check
npm run check
npm run check:watch

# Unit tests (vitest)
npm run test:unit
npm run test:unit:docs     # docs-only test suite

# Integration tests (Playwright, requires a built preview server)
npm run test:integration

# Lint / format
npm run lint
npm run format

# Regenerate component compliance map → updates COMPONENT_MAP.md
node ./scripts/make-component-maps.js

# Discover snippet migration candidates (dry-run preview)
node ./scripts/migrate-snippet.js

# Regenerate export indexes + registry before publishing
npm run prepackage          # package-pre.js → generate-registry-from-lib.cjs → make-pnpx.cjs
```

## Architecture

### Source layout

```
src/lib/
  base/        # Primitive display components (Alert, Avatar, Badge, Box, …)
  controls/    # Interactive form controls (Button, Checkbox, Select, Textfield, …)
  data/        # Data-display helpers (DataList, Finder, List, Loader, …)
  navigation/  # Navigation components (Drawer, Tabs)
  ui/          # App-shell components (Frame, Panel, Window, Menu, Toast, …)
  utils/       # Internal utilities (Slotted, Content, stylesheet, uses/stickTo, …)
  types/       # Shared TypeScript enums and base prop interfaces (CommonProps, theme, levels, …)
  index.ts     # Re-exports all four category index files
```

Each component lives in its own subdirectory (e.g. `src/lib/controls/button/`) together with:
- `Button.svelte` — the component
- `types.ts` — exports `[Component]DemoValues` and any supplementary types
- `index.ts` — re-exports the component(s) in the directory

### Key architectural patterns

**Svelte 5 runes** — All components use `$props()`, `$state()`, `$derived()`. Props type (`[Component]Props`) must be declared in `<script module lang="ts">` inside the component file itself (not imported from `./types`).

**Snippet components** — Small companion components that wrap a Svelte 5 `{#snippet}` so consumers can override specific slots. They live in the same directory as the parent. They must NOT have a `<script module>` block and must NOT include a `<style>` block. See `SNIPPET_COMPONENT.md` for the canonical template.

**`Slotted.svelte`** (`src/lib/utils/slotted/`) — Core rendering primitive. Accepts a `child` or `children` snippet plus `slotArgs`, re-renders with `{#key slotArgs}`.

**Styling** — Tailwind CSS v4 via `@tailwindcss/vite`. All component `<style>` blocks must use `lang="postcss"` and begin with `@reference "tailwindcss"`. No external `.css` file imports inside style blocks.

**Registry** — shadcn-compatible JSON registry generated by `scripts/generate-registry-from-lib.cjs`. Components are designed to be individually copyable into consumer projects.

## Component conventions (enforced by `COMPONENT_MAP.md`)

| Rule | How to fix |
|---|---|
| `[Component]Props` must be declared inside the `.svelte` file (Int. ✅) | Add/move the interface to `<script module lang="ts">` |
| `[Component]Props` must NOT be imported from `./types` (Ext. ✅) | Remove the import |
| `types.ts` must exist and export `[component]DemoValues` (Demo ✅) | Create/update `types.ts` |
| Style must use `lang="postcss"` (PostCss ✅) | Add attribute to `<style>` |
| Style must contain `@reference "tailwindcss"` (Ref ✅) | Add the directive |
| No external `.css` imports in style (Css ✅) | Remove `@import` / `url(...)` from `<style>` |

Run `node ./scripts/make-component-maps.js` after any component changes to update `COMPONENT_MAP.md` and verify compliance.

## Migration context

The project is actively migrating to Svelte 5 + Tailwind CSS v4. SCSS has been removed. Track progress in:
- `COMPONENT_MAP.md` — per-component compliance snapshot (auto-generated)
- `MIGRATION_STATUS.md` — step-level migration status
- `MIGRATION.md` — decisions, rationale, snippet migration instructions
